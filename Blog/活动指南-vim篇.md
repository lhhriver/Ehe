# 基础知识

## 工作模式

![](https://gitee.com/liuhuihe/Ehe/raw/master/2022/01-Linux-20201215-231055-625176.png)

基本上 vi 共分为三种模式，分别是『一般指令模式』、『编辑模式』与『指令列命令模式』。

这三种模式的作用分别是：

- **一般指令模式 (command mode)**：以 vi 打开一个文件就直接进入一般指令模式了(这是默认的模式，也简称为一般模式)。在这个模式中：
    - 可以使用『上下左右』按键来移动光标。
    - 可以使用『删除字符』或『删除整列』来处理文件内容。
    - 可以使用『复制、贴上』来处理你的文件数据。

- **编辑模式 (insert mode)**：按下『i, I, o, O, a, A, r, R』等任何一个字母之后才会进入编辑模式。在画面的左下方会出现『 INSERT 或 REPLACE 』的字样，此时才可以进行编辑。而如果要回到一般指令模式时， 则必须要按下『**Esc**』这个按键即可退出编辑模式。

- **指令列命令模式 (command-line mode)**：在一般模式当中，输入『 : / ? 』三个中的任何一个按钮，就可以将光标移动到最底下那一列。在这个模式当中， 可以提供你『搜寻资料』的动作，而读取、存盘、大量取代字符、离开 vi 、显示行号等等的动作则是在此模式中达成的！

## vim 键盘图

![img](https://gitee.com/liuhuihe/Ehe/raw/master/2022/685007-20190219103545499-1516663381.png)

# 切换编辑模式

| 指令  | 说明                                                         |
| :---: | ------------------------------------------------------------ |
| i, I  | 进入编辑模式(Insert mode)：<br />**i 为『从光标所在处输入』**； <br />I 为『在目前所在行的第一个非空格符处开始输入』。 |
| a, A  | 进入编辑模式(Insert mode)：<br />**a 为『从光标所在的下一个字符处开始输入』**； <br />A 为『从光标所在行的最后一个字符处开始输入』。 |
| o, O  | 进入编辑模式(Insert mode)：<br />**o 为『从光标所在的下一行处输入新的一行』**； <br />O 为在目前光标所在处的上一行输入新的一行！ |
| r, R  | 进入取代模式(Replace mode)：<br />r 只会取代光标所在的那一个字符一次；<br />R会一直取代光标所在的文字，直到按下 ESC 为止； |
| [Esc] | 退出编辑模式，回到一般模式。                                 |

# 一般指令模式

## 移动光标

|  级别  |             指令             | 说明                                                         |
| :----: | :--------------------------: | ------------------------------------------------------------ |
| 字符级 |          **h** 或 ←          | 光标向左移动一个字符，20h即执行20次                          |
| 字符级 |          **l** 或 →          | 光标向右移动一个字符，20l即执行20次                          |
| 字符级 | **0  或 \|** <br />或 Home键 | 这是数字『 0 』：移动到这一行的最前面字符处                  |
| 字符级 |            **^**             | 移动到本行的第一个不是blank字符（包括空格，Tab，换行，回车等）的位置 |
| 字符级 |        **$** 或 End键        | 移动到这一行的最后面字符处                                   |
| 字符级 |              w               | 移动到下一单词的开头。单词由字母，数字，下划线组成           |
| 字符级 |              W               | 移动到下一单词的开头。单词由blank字符分开                    |
| 字符级 |              e               | 移动到单词的词尾。单词由字母，数字，下划线组成               |
| 字符级 |              E               | 移动到单词的词尾。单词由blank字符分开                        |
| 字符级 |              ge              | 前一个单词的最后一个字符                                     |
| 字符级 |              >>              | 缩进                                                         |
| 字符级 |              <<              | 反缩进                                                       |
|  行级  |          **j** 或 ↓          | 光标向下移动一个字符，20j即执行20次                          |
|  行级  |          **k** 或 ↑          | 光标向上移动一个字符，20k即执行20次                          |
|  行级  |         **Ctrl + e**         | 向下滚动一行，长按持续滚动                                   |
|  行级  |         **Ctrl + y**         | 向上滚动一行，长按持续滚动                                   |
|  行级  |              +               | 光标移动到非空格符的下一行                                   |
|  行级  |              -               | 光标移动到非空格符的上一行                                   |
|  行级  |         **n<Enter>**         | n 为数字。光标向下移动 n 行                                  |
| 页面级 |         **Ctrl + f**         | 屏幕『向下』移动一页，相当于 [Page Down]按键                 |
| 页面级 |         **Ctrl + b**         | 屏幕『向上』移动一页，相当于 [Page Up] 按键                  |
| 页面级 |           Ctrl + d           | 屏幕『向下』移动半页                                         |
| 页面级 |           Ctrl + u           | 屏幕『向上』移动半页                                         |
| 页面级 |            **H**             | 光标移动到这个屏幕的最上方那一行的第一个字符                 |
| 页面级 |            **M**             | 光标移动到这个屏幕的中央那一行的第一个字符                   |
| 页面级 |            **L**             | 光标移动到这个屏幕的最下方那一行的第一个字符                 |
| 文档级 |            **G**             | 移动到这个档案的最后一行                                     |
| 文档级 |            **nG**            | n 为数字。移动到这个档案的第 n 行。例如 20G 则会移动到这个档案的第 20 行 |
| 文档级 |            **gg**            | 移动到这个档案的第一行，相当于 1G 啊！                       |
| 文档级 |           **ngg**            | n 为数字，移动到这个档案的第 n 行。                          |
| 文档级 |              n%              | 到文件n%的位置                                               |
|  句级  |            **（**            | 句首                                                         |
|  句级  |            **）**            | 下一句首                                                     |
|  段级  |            **{**             | 段首                                                         |
|  段级  |            **}**             | 段尾                                                         |
|        |         **Ctrl + o**         | 跳回原来的位置                                               |

## 字符搜索

|   指令    | 说明                                                         |
| :-------: | ------------------------------------------------------------ |
|   **#**   | 移动光标到上一个与当前单词匹配的单词上                       |
|   *****   | 移动光标到下一个与当前单词匹配的单词上                       |
| **/word** | 向光标之下寻找一个名称为 word 的字符串。<br />例如要在档案内搜寻 vbird 这个字符串，就输入 /vbird 即可！ |
| **?word** | 向光标之上寻找一个字符串名称为 word 的字符串。               |
|  /word\c  | \c代表大小写不敏感查找，\C代表大小写敏感                     |
|   **n**   | 这个 n 是英文按键。代表重复前一个搜寻的动作。                |
|   **N**   | 这个 N 是英文按键。与 n 刚好相反，为『反向』进行前一个搜寻动作。 |

## 复制与粘贴

| 类别 |  级别  |   指令   | 说明                                                         |
| :--: | :----: | :------: | ------------------------------------------------------------ |
| 复制 | 字符级 |    y0    | 复制光标所在的那个字符到该行行首的所有数据                   |
| 复制 | 字符级 |    y$    | 复制光标所在的那个字符到该行行尾的所有数据                   |
| 复制 | 字符级 |  **yw**  | 复制光标所在位置到该单词结尾<br />3yw 则是复制后3个单词      |
| 复制 |  行级  |  **yy**  | 复制游标所在的那一行                                         |
| 复制 |  行级  | **nyy**  | n 为数字。复制光标所在的向下 n 行，例如 20yy 则是复制 20 行(常用) |
| 复制 | 文档级 |   y1G    | 复制游标所在行到第一行的所有数据                             |
| 复制 | 文档级 |    yG    | 复制游标所在行到最后一行的所有数据                           |
| 复制 | 文档级 | **ggyG** | 复制全文                                                     |
| 粘贴 |        |  **p**   | p 为将已复制的数据在光标下一行贴上<br />**示例**：【**yyp**】将光标所在行复制到下一行。 |
| 粘贴 |        |  **P**   | P 为将已复制的数据贴在游标上一行！                           |

**补充**：d为剪切：

- dd   剪切整行
- d^   剪切至行首
- d$   剪切至行尾
- dw   剪切一个word
- dG   剪切至档尾 

## 删除

|  级别  |      指令       | 说明                                                         |
| :----: | :-------------: | ------------------------------------------------------------ |
| 字符级 |        x        | 在一行字当中，x 为向后删除一个字符 (相当于 [del] 按键)       |
| 字符级 |       nx        | n 为数字，连续向后删除 n 个字符。举例来说，我要连续删除 10 个字符， 『10x』。 |
| 字符级 |      **X**      | X 为向前删除一个字符（相当于 [backspace] 亦即是退格键）      |
| 字符级 |       diw       | 删除光标所在的单词，不包括空白字符                           |
| 字符级 |       daw       | 删除光标所在的单词，包括空白字符                             |
| 字符级 |       dw        | 从当前位置删除到下一个单词词首                               |
| 字符级 |        s        | 删除字符并插入（单个字符删除，并进入插入模式）               |
| 字符级 | **d$** 或 **D** | 删除游标所在处到该行的最后一个字符                           |
| 字符级 |     **d0**      | 那个是数字的 0 ，删除游标所在处到该行的最前面一个字符        |
| 字符级 |        C        | 删除游标所在处到该行的最后一个字符并进入编辑模式             |
|  行级  |        S        | 删除行并进入插入模式（整行删除）                             |
|  行级  |     **dd**      | 删除游标所在的那一整行(常用)                                 |
|  行级  |     **ndd**     | n 为数字。删除光标所在的向下 n 行，例如 20dd 则是删除 20 行  |
|  行级  | d1G 或 **dgg**  | 删除光标所在到第一行的所有数据                               |
|  行级  |     **dG**      | 删除光标所在到最后一行的所有数据                             |
|  行级  |        c        | 重复删除多个数据，例如向下删除 10 行，[ 10cj ]               |
| 文档级 |    **ggdG**     | 删除所有内容，gg为跳转到文件首行；dG为删除光标所在行以及其下所有行的内容； |

## 其他

| 类别 |    指令    | 说明                                                         |
| :--: | :--------: | ------------------------------------------------------------ |
| 合并 |     J      | 将光标所在行与下一行的数据结合成同一行                       |
| 撤销 |   **u**    | 撤销命令，复原前一个动作。                                   |
| 撤销 |   **U**    | 取消当前行中所有的改动                                       |
| 恢复 | **Ctrl+r** | 应当理解为u的反义，即只有当撤销了某个命令后，ctrl+ r可以再次恢复这个命令。 |
| 重复 |   **.**    | 意思是重复前一个动作的意思。                                 |
|      |   **zz**   | 将当前行移动到屏幕中央                                       |
|      |   **zt**   | 将当前行移动到屏幕顶端                                       |
|      |   **zb**   | 将当前行移动到屏幕底端                                       |
|      |     ZZ     | 若档案没有更动，则不储存离开，若档案已经被更动过，则储存后离开！ |
|      |     ZQ     | 不保存退出编辑                                               |

# 指令行模式

## 批量写入

| 级别 |        命令         | 说明                                 |
| :--: | :-----------------: | ------------------------------------ |
| 行级 |     :%s/^/xxx/g     | 在每一行的行首插入xxx，^表示行首     |
| 行级 |     :%s/$/xxx/g     | 在每一行的行尾插入xxx，$表示行尾     |
| 行级 | **:n1,n2s/^/xxx/g** | 在n1行到n2行的行首插入xxx，^表示行首 |
| 行级 | **:n1,n2s/$/xxx/g** | 在n1行到n2行的行尾插入xxx，$表示行尾 |

## 字符替换

|  级别  |                            指令                            | 说明                                                         |
| :----: | :--------------------------------------------------------: | ------------------------------------------------------------ |
|  行级  |                         :s/old/new                         | 用new替换当前行第一个old                                     |
|  行级  |                        :s/old/new/g                        | 用new替换当前行所有的old                                     |
|  行级  |                 **:n1,n2s/word1/word2/g**                  | n1 与 n2 为数字。在第 n1 与 n2 行之间寻找 word1 这个字符串，并将该字符串取代为 word2 ！<br />举例来说：在 100 到 200 行之间搜寻 vbird 并取代为 VBIRD 则：『:100,200s/vbird/VBIRD/g』。 |
|  行级  |                     :.,+2s/word/excel                      | 替换当前行与接下来2行的word为excel                           |
| 文档级 | :1,$s/word1/word2/g  <br />或  <br />**:%s/word1/word2/g** | 从第一行到最后一行寻找 word1 字符串，并将该字符串取代为 word2 ！ |
| 文档级 | :1,$s/word1/word2/gc <br />或 <br />**:%s/word1/word2/gc** | 从第一行到最后一行寻找 word1 字符串，并将该字符串取代为 word2 ！<br />且在取代前显示提示字符给用户确认 (confirm) 是否需要取代！(常用) |
| 文档级 |                    **:.,$s/word/excel**                    | 替换当前行到最后一行的word为excel，.代表当前行，$代表最后一行。 |

## 保存与退出

|          指令          | 说明                                                         |
| :--------------------: | ------------------------------------------------------------ |
|           :w           | 将编辑的数据写入硬盘档案中(常用)                             |
|        **:w!**         | 若文件属性为『只读』时，强制写入该档案。不过，到底能不能写入， 还是跟你对该档案的档案权限有关啊！ |
|           :q           | 离开 vi (常用)                                               |
|        **:q!**         | 若曾修改过档案，又不想储存，使用 ! 为强制离开不储存档案。    |
|        **:wq**         | 储存后离开，若为 :wq! 则为强制储存后离开 (常用)              |
|     :w [filename]      | 将编辑的数据储存成另一个档案（类似另存新档）                 |
|  :n1,n2 w [filename]   | 将 n1 到 n2 的内容储存成 filename 这个档案。                 |
| :saveas <path/to/file> | 文件另存为<path/to/file>                                     |
|           :e           | 重新加载当前文档                                             |
|          :e!           | 重新加载当前文档，并丢弃已做的改动                           |

## 环境设定

|                    指令                    | 说明                                                         |
| :----------------------------------------: | ------------------------------------------------------------ |
|         **:set nu<br />:set nonu**         | 设定与取消行号                                               |
|             **:syntax enable**             | 语法高亮                                                     |
|               **:set wrap**                | warp：自动换行，nowrap：不自动换行                           |
|             **:set incsearch**             | 逐步搜索模式，对当前键入的字符进行查找，不必等输入完成       |
|            **:set ignorecase**             | 忽略大小写                                                   |
| :set list<br />:set nolist<br />:set list! | list：显示非可见字符<br />nolist：隐藏不可见字符<br />list!：切换显示或隐藏不可见字符 |
|     :set hlsearch<br />:set nohlsearch     | hlsearch 就是 high light search(高亮度搜寻)。 这个就是设定是否将搜寻的字符串反白的设定值。默认值是 hlsearch |
|              :set autoindent               | 自动缩进，autoindent 就是自动缩进。noautoindent不自动缩进    |
|                :set backup                 | 是否自动储存备份档？一般是 nobackup 的， 如果设定 backup 的话，那么当你更动任何一个文件时，则源文件会被另存成一个档名为 filename~ 的文件。 举例来说，我们编辑 hosts ，设定 :set backup ，那么当更动 hosts 时，在同目录下，就会产生 hosts~文件名的文件，记录原始的 hosts 文件内容 |
|                 :set ruler                 | 还记得我们提到的右下角的一些状态栏说明吗？ 这个 ruler 就是在显示或不显示该设定值的啦！ |
|               :set showmode                | 这个则是，是否要显示 --INSERT-- 之类的字眼在左下角的状态栏。 |
|            :set backspace=(012)            | 一般来说， 如果我们按下 i 进入编辑模式后，可以利用退格键 (backspace) 来删除任意字符的。 但是，某些 distribution 则不许如此。此时，我们就可以透过 backspace来设定，当 backspace 为 2 时，就是可以删除任意值；0 或 1 时，仅可删除刚刚输入的字符， 而无法删除原本就已经存在的文字了！ |
|                  :set all                  | 显示目前所有的环境参数设定值。                               |
|                    :set                    | 显示与系统默认值不同的设定参数， 一般来说就是你有自行变动过的设定参数啦！ |
|        :syntax on<br />:syntax off         | 是否依据程序相关语法显示不同颜色                             |
|      :set bg=dark<br />:set bg=light       | 可用以显示不同的颜色色调，预设是『light 』。如果你常常发现批注的字体深蓝色实在很不容易看， 那么这里可以设定为 dark 喔！试看看，会有不同的样式呢！ |
|                  :set key                  | 设置密码                                                     |
|                 :set spell                 | 打开拼写检查                                                 |
|               set foldenable               | 打开代码折叠功能，可以写在根目录下的**.vimrc**文件里<br />set foldmethod=syntax，syntax: 按 C \ C++ 语法折叠 {};  <br />indent: 按缩进折叠，适用于 Python |

## 窗口拆分

| 指令  | 说明                                   |
| :---: | -------------------------------------- |
|  :sp  | `split`横向分隔屏幕，后面可以加文件名  |
|  :vs  | `vsplit`纵向分隔屏幕，后面可以加文件名 |
| :only | 只保留光标所在分屏，关闭其他分屏       |

##  多文档编辑

|        指令        | 说明                                                         |
| :----------------: | ------------------------------------------------------------ |
|   :r [filename]    | 在编辑的数据中，读入另一个档案的数据。亦即将 『filename』 这个档案内容加到游标所在行后面 |
| :e <path/to/file>  | 关闭当前文件，打开新的文件                                   |
| :e+ <path/to/file> | 打开新文件，并从文件尾开始编辑                               |
|        :ls         | vim可以同时打开多个文件，该命令可以列出所有打开的文件的列表  |
|         :n         | 切换到下一个被打开的文件                                     |
|         :N         | 切换到上一个被打开的文件                                     |

## 其他

|            指令             | 说明                                                         |
| :-------------------------: | ------------------------------------------------------------ |
|      :set fileencoding      | 查看当前文件的编码                                           |
| **:set fileencoding=utf-8** | 将文件转换成utf-8格式，将更改写入的文件的输出编码            |
|        :set encoding        | 查看当前编码                                                 |
|   **:set encoding=utf-8**   | 将更改终端中显示的输出编码                                   |
|           :set ff           | 查看当前文件的格式，set ff=unix，设置文件格式。ff与fileformat等效 |
|            :pwd             | 显示vim的工作目录                                            |
|       **:! command**        | 暂时离开 vi 到指令行模式下执行 command 的显示结果！<br />例如：『:! ls /home』即可在 vi 当中察看 /home 底下以 ls 输出的档案信息！ |
|             :ce             | 本行文字居中                                                 |
|             :le             | 本行文字靠左                                                 |
|             :ri             | 本行文字靠右                                                 |

# 可视化模式

在 Vim 中，如果想选中目标文本，就需要调整 Vim 进入可视化模式，如下所示，通过在 Vim 命令模式下键入不同的键，可以进入不同的可视化模式。

|   指令   | 说明                                                         |
| :------: | ------------------------------------------------------------ |
|    v     | 又称`字符可视化`模式，此模式下目标文本的选择是以字符为单位的，也就是说，该模式下要一个字符一个字符的选中要操作的文本。进入标记： --VISUAL-- |
|    V     | 又称`行可视化`模式，此模式化目标文本的选择是以行为单位的，也就是说，该模式化可以一行一行的选中要操作的文本。进入标记：-- VISUAL LINE -- |
| Ctrl + v | 又称`块可视化`模式，该模式下可以选中文本中的一个矩形区域作为目标文本，以按下 Ctrl+v 位置作为矩形的一角，光标移动的终点位置作为它的对角。进入标记： -- VISUAL BLOCK -- |

在 Vim 命令模式下编辑文本的很多命令，在可视化模式下仍然可以使用。下面罗列出了常用的几个可以在可视化模式下使用的命令。

| 指令 | 说明                                          |
| :--: | --------------------------------------------- |
|  d   | 删除选中的部分文本。                          |
|  D   | 删除选中部分所在的行                          |
|  y   | 将选中部分复制到剪贴板中。                    |
|  p   | 将剪贴板中的内容粘贴到光标之后。              |
|  P   | 将剪贴板中的内容粘贴到光标之前。              |
|  u   | 将选中部分中的大写字符全部改为小写字符。      |
|  U   | 将选中部分中的小写字符全部改为大写字符。      |
|  >   | 将选中部分右移（缩进）一个 tab 键规定的长度。 |
|  <   | 将选中部分左移一个 tab 键规定的长度。         |

# 代码相关

| 类别 |    指令     | 说明                                                         |
| :--: | :---------: | ------------------------------------------------------------ |
| 折叠 |     zc      | 在**Normal**模式下将光标移动到代码的可折叠位置，zc折叠代码(close) |
| 折叠 |     zo      | 在**Normal**模式下将光标移动到代码的可折叠位置，zo打开折叠的代码(open) |
| 跳转 |  CTRL + ]   | 函数跳转，先光标移到想要跳转的函数或变量上                   |
| 跳转 |  CTRL + t   | 回到跳转之前的位置                                           |
| 跳转 |     [[      | 向前跳到上一个函数头                                         |
| 跳转 |     ]]      | 向后跳到下一个函数头                                         |
| 跳转 | :tag 函数名 | 来跳转到对应的函数                                           |
| 跳转 |     [/      | 跳到注释开头                                                 |
| 跳转 |     ]/      | 跳到注释末尾                                                 |
| 跳转 |      %      | 匹配括号移动，包括“{}”、“[]”、“()”。要先将光标移动到括号上才能匹配 |

# 应用场景

|     场景     | 操作                                                         |
| :----------: | ------------------------------------------------------------ |
| 代码批量注释 | 1. Ctrl + v：进行块可视化模式。<br />2. j、k：选定需要注释的行。<br />3. shift + i：进入编辑模式，即大i（I）。<br />4. 第一行行首添加注释符。<br />5. Esc：前面选中的代码行会全部加上了注释符。 |
|              |                                                              |
|              |                                                              |

