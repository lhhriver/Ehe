# 第1章  C++概述

# 第2章 处理数据

# 第3章 分支结构

# 第4章 循环结构

# 第5章 数组

# 第6章 指针

# 第7章 函数初识

# 第8章 函数进阶

# 第9章 位运算符、构造类型与名称空间

# 第10章 面向对象与类

# 第11章 类的高级主题

## 深复制与浅复制

### 浅复制

#### **【例11-1】使用默认的拷贝构造函数**

```c++
//文件:ex11_1.cpp
#include <iostream>
#include <cstring>
using namespace std;

class Student
{
private:
    int number; //学号
    char *name; //姓名
    
public:
    Student(int no, char *n);
    void show(); //显示学生信息
    void setNumber(int no);
    void setName(char *n);
};

Student::Student(int no, char *n)
{
    number = no;
    name = new char[strlen(n) + 1]; //申请内存
    strcpy(name, n);                //字符串赋值
}

void Student::setNumber(int no)
{
    number = no;
}

void Student::setName(char *n)
{
    if (name != NULL)
    {
        delete[] name;
        name = new char[strlen(n) + 1];
        strcpy(name, n);
    }
}

void Student::show()
{
    if (name != NULL) // name不是NULL才显示
    {
        cout << "学号:" << number << "\t";
        cout << "姓名:" << name << "\n";
    }
}

int main()
{
    Student s1(20200101, "张三");
    Student s2(s1);
    s1.show();
    s2.show();
}

```

输出：

```
学号:20200101   姓名:张三
学号:20200101   姓名:张三
```

### 深复制

#### **【例11-2】使用拷贝构造函数实现深复制**

```c++
//文件:ex11_2.cpp
#include <iostream>
#include <cstring>
using namespace std;

class Student
{
private:
    int number; //学号
    char *name; //姓名
    
public:
    Student(int no, char *n);
    Student(const Student &s);
    void show(); //显示学生信息
    void setNumber(int no);
    void setName(char *n);
};

Student::Student(int no, char *n)
{
    number = no;
    name = new char[strlen(n) + 1]; //申请内存
    strcpy(name, n);                //字符串赋值
}

Student::Student(const Student &s) //	新对象与参数s一样
{
    number = s.number;
    name = new char[strlen(s.name) + 1];
    strcpy(name, s.name);
}

void Student::show()
{
    if (name != NULL) // name不是NULL才显示
    {
        cout << "学号:" << number << "\t";
        cout << "姓名:" << name << "\n";
    }
}

void Student::setNumber(int no)
{
    number = no;
}

void Student::setName(char *n)
{
    if (name != NULL)
    {
        delete[] name;
        name = new char[strlen(n) + 1];
        strcpy(name, n);
    }
}

int main()
{
    Student s1(20200101, "张三");
    Student s2(s1);
    s1.show();
    s2.show();
    
    cout << "-------------\n";
    s2.setNumber(20200102);
    s2.setName("李四");
    s1.show();
    s2.show();
    return 0;
}

```

输出：

```
学号:20200101   姓名:张三
学号:20200101   姓名:张三
-------------
学号:20200101   姓名:张三
学号:20200102   姓名:李四
```



## 类的组合

### 什么是类的组合

#### **【例11-3】类的组合**

##### ex11_3Point.h

```c++
//文件:ex11_3Point.h
#ifndef EX11_3POINT_H
#define EX11_3POINT_H
class Point
{
private:
    int x;
    int y;

public:
    Point(int x1 = 0, int y1 = 0);
    Point(const Point &p);
    int getX();
    int getY();
};
#endif

```

##### ex11_3Point.cpp

```c++
//文件ex11_3Point.cpp
#include "ex11_3Point.h"

Point::Point(int x1, int y1)
{
    x = x1;
    y = y1;
}

Point::Point(const Point &p)
{
    x = p.x;
    y = p.y;
}

int Point::getX()
{
    return x;
}

int Point::getY()
{
    return y;
}

```

##### ex11_3Circle.h

```c++
//文件:ex11_3Circle.h
#ifndef EX11_3CIRCLE_H
#define EX11_3CIRCLE_H
#include "ex11_3Point.h"

class Circle
{
private:
    const double PI;
    Point center;
    double radius;

public:
    Circle(const Point &p, double r);
    Circle(const Circle &c);
    void show();
};
#endif

```

##### ex11_3Circle.cpp

```c++
//文件:ex11_3Circle.cpp
#include <iostream>
#include "ex11_3Circle.h"
using namespace std;

Circle::Circle(const Point &p, double r) : PI(3.14159), center(p)
{
    radius = r;
}

Circle::Circle(const Circle &c) : PI(c.PI)
{
    center = c.center;
    radius = c.radius;
}

void Circle::show()
{
    cout << "center:(" << center.getX() << "," << center.getY() << ")\n";
    cout << "radius:" << radius << endl;
}

```

##### ex11_3Main.cpp

```c++
//文件:ex11_3Main.cpp
#include <iostream>
using namespace std;
#include "ex11_3Circle.h"

int main()
{
    Point p(20, 30);
    Circle c(p, 100);
    c.show();
}

```

编译：

```shell
g++ -g -o out ex11_3Main.cpp ex11_3Circle.cpp ex11_3Point.cpp
```

执行：

```shell
.\out.exe
```

输出：

```
center:(20,30)
radius:100
```

### 组合类的构造过程

#### **【例11-4】三角形类**

##### ex11_4Point.h

```c++
//文件:ex11_4Point.h
#ifndef EX11_4POINT_H
#define EX11_4POINT_H
class Point
{
private:
    int x;
    int y;

public:
    Point(int x1 = 0, int y1 = 0);
    Point(const Point &p);
    int getX();
    int getY();
};
#endif

```

##### ex11_4Point.cpp

```c++
//文件:ex11_4Point.cpp
#include <iostream>
using namespace std;
#include "ex11_4Point.h"

Point::Point(int x1, int y1)
{
    x = x1;
    y = y1;
}

Point::Point(const Point &p)
{
    x = p.x;
    y = p.y;
    cout << "point的拷贝构造方法：" << x << "," << y << endl;
}

int Point::getX()
{
    return x;
}

int Point::getY()
{
    return y;
}

```

##### ex11_4Triangle.h

```c++
//文件:ex11_4Triangle.h
#ifndef EX11_4TRIANGLE_H
#define EX11_4TRIANGLE_H
#include "ex11_4Point.h"

class Triangle
{
private:
    Point point1;
    Point point2;
    Point point3;

public:
    Triangle(const Point &p1, const Point &p2, const Point &p3);
    void show();
};
#endif

```

##### ex11_4Triangle.cpp

```c++
//文件:ex11_4Triangle.cpp
#include <iostream>
using namespace std;
#include "ex11_4Triangle.h"

Triangle::Triangle(const Point &p1, const Point &p2, const Point &p3)
    : point2(p2), point3(p3), point1(p1)
{
    cout << "Trangle对象构造完毕！\n";
}

void Triangle::show()
{
    cout << "point1:(" << point1.getX() << "," << point1.getY() << ")\n";
    cout << "point2:(" << point2.getX() << "," << point2.getY() << ")\n";
    cout << "point3:(" << point3.getX() << "," << point3.getY() << ")\n";
}

```

##### ex11_4Main.cpp

```c++
//文件:ex11_4Main.cpp
#include <iostream>
using namespace std;
#include "ex11_4Triangle.h"
int main()
{
    Point p1(20, 30);
    Point p2(20, 60);
    Point p3(50, 40);
    Triangle t(p1, p2, p3);
    t.show();
}

```

编译：

```shell
g++ -g -o out ex11_4Main.cpp ex11_4Triangle.cpp ex11_4Point.cpp
```

执行：

```shell
.\out.exe
```

输出：

```
point的拷贝构造方法：20,30
point的拷贝构造方法：20,60
point的拷贝构造方法：50,40
Trangle对象构造完毕！
point1:(20,30)
point2:(20,60)
point3:(50,40)
```



## 友元

### 友元函数

#### **【例11-5】求两点之间的距离**

```c++
//文件:ex11_5.cpp
#include <iostream>
#include <cmath>
using namespace std;

class Point
{
public:
    Point(int xx = 0, int yy = 0);
    int getX();
    int getY();

private:
    int x, y;
};

Point::Point(int xx, int yy)
{
    x = xx;
    y = yy;
};

int Point::getX()
{
    return x;
}

int Point::getY()
{
    return y;
}

double getDistance(Point start, Point end)
{
    int x1, y1, x2, y2;
    double d;
    x1 = start.getX(); // x1=start.x;
    y1 = start.getY();
    x2 = end.getX();
    y2 = end.getY();
    
    d = sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));
    return d;
}

int main()
{
    Point p1(1, 1), p2(4, 5);
    double d;
    d = getDistance(p1, p2);
    cout << "The distance is :" << d << endl;
    return 0;
}

```

输出：

```
The distance is :5
```



### 友元类

#### **【例11-6】友元类的使用**

```c++
//文件:ex11_6.cpp
#include <iostream>
using namespace std;

class A
{
private:
    int x;

public:
    friend class B;
};

class B
{
private:
    A a;

public:
    void set(int i)
    {
        a.x = i; // B类set函数访问A类的属性
    }
    
    void display()
    {
        cout << "B: diaplay: " << a.x << endl;
    }
};

int main()
{
    B b;
    b.set(10);
    b.display();
    return 0;
}

```

输出：

```
B: diaplay: 10
```



## 静态成员

### 静态数据成员

#### **【例11-7】使用静态数据成员**

```c++
//文件:ex11_7.cpp
#include <iostream>
#include <cstring>
using namespace std;

class Student
{
private:
    static int count;
    int number;
    char name[10];
    int age;

public:
    Student(char *n, int a)
    {
        count++;
        number = 202000 + count;
        strcpy(name, n);
        age = a;
    }

    int getNumber()
    {
        return number;
    }

    char *getName()
    {
        return name;
    }

    int getAge()
    {
        return age;
    }

    int getCount()
    {
        return count;
    }
};

int Student::count = 0;

int main()
{
    Student s1("张三", 18);
    Student s2("李四", 19);
    Student s3("王五", 17);
    cout << s1.getNumber() << "\t" << s1.getName() << "\t" << s1.getAge() << endl;
    cout << s2.getNumber() << "\t" << s2.getName() << "\t" << s2.getAge() << endl;
    cout << s3.getNumber() << "\t" << s3.getName() << "\t" << s3.getAge() << endl;
    cout << "s1.getCount(): " << s1.getCount() << endl;
    cout << "s2.getCount(): " << s2.getCount() << endl;
    cout << "s3.getCount(): " << s3.getCount() << endl;
    return 0;
}

```

输出：

```
202001  张三    18
202002  李四    19
202003  王五    17
s1.getCount(): 3
s2.getCount(): 3
s3.getCount(): 3
```



### 静态成员函数

#### **【例11-8】在Student 类中添加静态成员函数**

```c++
//文件:ex11_8.cpp
#include <iostream>
#include <cstring>
using namespace std;

class Student
{
private:
    static int count;
    int number;
    char name[10];
    int age;

public:
    Student(char *n, int a)
    {
        count++;
        number = 202000 + count;
        strcpy(name, n);
        age = a;
    }
    
    int getNumber()
    {
        return number;
    }
    
    char *getName()
    {
        return name;
    }
    
    int getAge()
    {
        return age;
    }
    
    static int getCount()  
    {
        return count;
    }
};

int Student::count = 0;

int main()
{
    cout << Student::getCount() << "个学生" << endl;
    Student s1("张三", 18);
    cout << Student::getCount() << "个学生" << endl;
    Student s2("李四", 19);
    cout << Student::getCount() << "个学生" << endl;
    Student s3("王五", 17);
    cout << Student::getCount() << "个学生" << endl;
    cout << s1.getNumber() << "\t" << s1.getName() << "\t" << s1.getAge() << endl;
    cout << s2.getNumber() << "\t" << s2.getName() << "\t" << s2.getAge() << endl;
    cout << s3.getNumber() << "\t" << s3.getName() << "\t" << s3.getAge() << endl;
    return 0;
}

```

输出：

```
0个学生
1个学生
2个学生
3个学生
202001  张三    18
202002  李四    19
202003  王五    17
```



## 常对象与常成员函数

### 常对象

#### **【例11-9】常对象调用普通成员函数产生的错误**

```c++
//文件:ex11_9.cpp
#include <iostream>
using namespace std;

class A
{
private:
    float x, y;

public:
    A(float a, float b)
    {
        x = a;
        y = b;
    }
    
    void output()
    {
        cout << x << "," << y << endl;
    }
};

int main()
{
    const A a(20, 30);
    A b(50, 60);
    // a.output(); //  错误，常对象不能调用普通成员函数
    b.output();
    return 0;
}

```

输出：

```
50,60
```



### 常成员函数

#### **【例11-10】使用常成员函数**

```c++
//文件:ex11_10.cpp
#include <iostream>
using namespace std;

class A
{
private:
    float x, y;

public:
    A(float a, float b);
    void output();
    void output() const;
};

A::A(float a, float b)
{
    x = a;
    y = b;
}

void A::output()
{
    cout << "普通成员函数" << endl;
    cout << x << "," << y << endl;
}

void A::output() const
{
    cout << "常成员函数" << endl;
    cout << x << "," << y << endl;
}
int main()
{
    const A a(20, 30);
    A b(50, 60);
    a.output(); //  调用常成员函数
    b.output(); //  调用普通成员函数
    return 0;
}

```

输出：

```
常成员函数
20,30
普通成员函数
50,60
```

## 对象数组与对象指针

### 对象数组

#### **【例11-11】对象数组的应用**

```c++
//文件:ex11_11.cpp
#include <iostream>
#include <cstring>
using namespace std;

class Student
{
private:
    int number;
    char name[10];
    int age;

public:
    Student(int xh, char *xm, int a);
    int getAge();
    void show();
};

Student::Student(int xh, char *xm, int a)
{
    number = xh;
    strcpy(name, xm);
    age = a;
}

int Student::getAge()
{
    return age;
}

void Student::show()
{
    cout << number << "\t" << name << "\t" << age << endl;
}

int main()
{
    int sum = 0;
    Student s[3] = {
        Student(10001, "张三", 20),
        Student(10002, "李四", 22),
        Student(10003, "王五", 30),
    };
    
    for (int i = 0; i < 3; i++)
    {
        s[i].show();
        sum += s[i].getAge();
    }
    cout << "平均年龄：" << sum / 3 << endl;
    return 0;
}

```

输出：

```
10001   张三    20
10002   李四    22
10003   王五    30
平均年龄：24
```



### 对象指针

#### **【例11-12】使用对象指针**

```c++
//文件:ex11_12.cpp
#include <iostream>
#include <cstring>
using namespace std;

class Student
{
private:
    int number;
    char name[10];
    int age;

public:
    Student(int xh, char *xm, int a);
    int getAge();
    void show();
};

Student::Student(int xh, char *xm, int a)
{
    number = xh;
    strcpy(name, xm);
    age = a;
}

int Student::getAge()
{
    return age;
}

void Student::show()
{
    cout << number << "\t" << name << "\t" << age << endl;
}

int main()
{
    int sum = 0;
    Student *p[3];
    p[0] = new Student(10001, "张三", 20);
    p[1] = new Student(10002, "李四", 22);
    p[2] = new Student(10003, "王五", 30);
    
    for (int i = 0; i < 3; i++)
    {
        p[i]->show();
        sum += p[i]->getAge();
    }
    cout << "平均年龄：" << sum / 3 << endl;
    
    for (int i = 0; i < 3; i++)
    {
        delete p[i];
    }
    return 0;
}

```

输出：

```
10001   张三    20
10002   李四    22
10003   王五    30
平均年龄：24
```



## this 指针

### 什么是this 指针

### this 指针的应用

#### **【例11-13】使用this 指针**

```c++
//文件:ex11_13.cpp
#include <iostream>
#include <cstring>
using namespace std;

class Student
{
private:
    int number;
    char name[10];
    int age;

public:
    Student(int xh, char *xm, int a);
    int getAge();
    void show();
    Student max(const Student &s);
};

Student::Student(int xh, char *xm, int a)
{
    number = xh;
    strcpy(name, xm);
    age = a;
}

int Student::getAge()
{
    return age;
}

void Student::show()
{
    cout << number << "\t" << name << "\t" << age << endl;
}

Student Student::max(const Student &s)
{
    if (this->age > s.age)
        return *this;
    else
        return s;
}

int main()
{
    int sum = 0;
    Student s1(10001, "张三", 30);
    Student s2(10002, "李四", 22);
    Student s3 = s1.max(s2);
    s3.show();
    return 0;
}

```

输出：

```
10001   张三    30
```

## 小结

## 习题十











