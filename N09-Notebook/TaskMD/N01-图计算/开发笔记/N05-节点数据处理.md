# 节点数据处理

## 位置类

### 区域【ControlArea】



### 纬度节点【Latitude】



### 经度节点【Longitude】



## 电压类

### 基准电压等级【BaseVoltage】



### 电压等级【VoltageLevel】



### 变压器电压等级【SubVL】



## 4.3.厂站类

### 变电站【Substation】

> 1、从Substation_vl.csv文件中读取变电站基本数据，详见属性列表。
>
> 2、写入变电站与meas的关联关系Meas_sub，关联id为（ACline_dot的id、@subid），可参考ACline_dot节点数据逻辑。
>
> 3、构建topoND到变电站【substation】的连接关系【topoid_subid】
>
> 4、将变电站的经纬度更新至计算节点, 设置计算节点的Ri_vP与Ri_vQ属性值, 更新变电站结算节点的总P、Q

### 间隔节点【Bay】



## 设备类

### 发电机【unit】

> 1、从SynchronousMachine.csv文件中读取基本数据，详见属性列表。
>
> 2、使用【BaseVoltage】的【nomkV】更新【unit】的额定电压【base_value】
>
> 3、更新发电机【unit】的属性【Substation、name】
>
> 4、将设备名称【name】赋值给对应的遥测节点【meas】属性【devName】
>
> 5、将遥测数据【meas】的有功【PManual、P】、无功【QManual、Q】更新到设备的属性【Pimeas、Qimeas】
>
> 6、设置发电机【unit】的【off】属性
>
> - 将不平衡变电站【Substation】的发电机【unit】的@off设置成0(闭合)
> - 将所有发电机【unit】的变量@off设置为1(断开)   （覆盖1）
> - 将虚拟站【Substation】的发电机【unit】变量@off设置成0(闭合)
> - 将没有连接节点的ACline所在变电站【Substation】的发电机【unit】变量@off设置为0(闭合)
> - 将发电机【unit】的@off变量更新到属性【off】
>
> 7、选择属性off为0的设备及对应CN，使用设备的连接点ID【nd】更新设备、对应CN节点的计算节点变量【@topoID】
>
> 8、生成计算节点【TopoND】
>
> 9、构建与计算节点【TopoND】的关联关系。
>
> 10、将【发电机】的有功、无功、电压等级、额定电压、更新至与之相连的发电机【非孤岛计算节点】。
>
> 11、将发电机的计算节点的母线类型设置为PV节点。
>
> 12、将【发电机】的计算节点的ZJP(猜测为互阻抗)的属性值设置为0
>
> 13、将【发电机】的计算节点的ZJQ的属性值设置为0
>
> 14、计算设备【Unit】对应meas的@Pflag、@Qflag变量，@Pflag = PFlag + P_ManualFlag, @Qflag = QFlag + Q_ManualFlag

### 历史发电机节点【unit_history】



### 母线【BUS】

> 1、从BusbarSection.csv文件中读取母线基本数据，详见属性列表。
>
> 2、从analog_point节点中读取母线电压数据（value、quality）更新到节点meas中(P, PFlag)
>
> 3、使用【BaseVoltage】的【nomkV】更新【BUS】的额定电压【base_value】
>
> 4、更新母线【BUS】的属性【Substation、name】
>
> 5、将设备名称【name】赋值给对应的遥测节点【meas】属性【devName】
>
> 6、将遥测数据【meas】的有功【PManual、P】、无功【QManual、Q】更新到设备的属性【Pimeas、Qimeas】
>
> 7、选择属性off为0的设备及对应CN，使用设备的连接点ID【nd】更新设备、对应CN节点的计算节点变量【@topoID】
>
> 8、生成计算节点【TopoND】
>
> 9、构建与计算节点【TopoND】的关联关系。
>
> 10、将电容【C_P】的无功功率量测【Qimeas】更新至与之相连的母线【@Qimeas】中
>
> 11、更新母线电压>400的TopoND的变量【@bus_Q_meas】
>
> 12、所有变压器电压等级为525的变压器母线【bus】的设置为连接状态(start_pt设置为1)
>
> 13、将【母线】的电压幅值(V)、电压相角(Ang)、有功(Pimeas)、电压相角的量测(Ang_meas)、电压等级(volt)、母线名称(name)、额定电压(base_value)更新至与之相连的母线【非孤岛计算节点】
>
> 14、计算设备【Bus】对应meas的@Pflag、@Qflag变量，@Pflag = PFlag + P_ManualFlag, @Qflag = QFlag + Q_ManualFlag

### 双绕组变压器【two_port_transformer】

> 1、从two_port_winding.csv文件中读取双绕组变压器基本数据，详见属性列表。
>
> 2、修改双绕组变压器的额定功率【S】, 没有值的赋值为0.001
>
> 3、电阻标幺值(Rstar)、电抗标幺值(Xstar), 并将变压器的变比(t)设置为1
>
> 4、更新双绕组变压器two_port_transformer的属性【Substation、name】
>
> 5、计算双绕组变压器two_port_transformerde 变比【t】
>
> 6、将设备名称【name】赋值给对应的遥测节点【meas】属性【devName】
>
> 7、将遥测数据【meas】的有功【PManual、P】、无功【QManual、Q】更新到设备的属性【Pimeas、Qimeas】
>
> 8、更新双绕组变压器【two_port_transformer】的off值。
>
> - 将35KV到10KV双绕组变压器two_port_transformer的@off设置为1(断开)
> - 将双绕组变压器two_port_transformer两端存在Pimeas、Pimeas大于0.01的@off值设为0, 即: 闭合
> - 将【35KV、10KV】到【0.4KV、0.1KV】双绕组变压器two_port_transformer的@off设置为1(断开)
> - 将两边电压【35KV、10KV、6.3KV】一样的双绕组变压器two_port_transformer的@off设置为1(断开)
> - 将任意一边电压小于【1KV】的双绕组变压器two_port_transformer的@off设置为1(断开)
>
> 9、选择属性off为0的设备及对应CN，使用设备的连接点ID【nd】更新设备、对应CN节点的计算节点变量【@topoID】
>
> 10、生成计算节点【TopoND】
>
> 11、构建与计算节点【TopoND】的关联关系。
>
> 12、构建双绕组变压器支路。
>
> 13、将【变压器】的额定电压更新至【非孤岛计算节点】，将变压器的名字更新至计算节点。
>
> 14、将双绕组变压器的Pimeas以（id->Pimeas）的形式保存到@@two_port_p_MapAccum变量中，将Qimeas保存到@@two_port_q_MapAccum变量中。
>
> 15、将保存在@@two_port_p_MapAccum、@@two_port_q_MapAccum更新到topo_connect的（M_P_TLPF_list，M_Q_TLPF_list）和（M_P_TLPF，M_Q_TLPF）中。
>
> 16、计算设备【trans2】对应meas的@Pflag、@Qflag变量，@Pflag = PFlag + P_ManualFlag, @Qflag = QFlag + Q_ManualFlag
>
> 17、更新双绕组变压器支路topo_connect的Ri_eP、Ri_eQ属性值

### 双头分接开关【two_tap_changer】

> 1、从two_tap_changer.csv文件中读取基本数据，详见属性列表。
>
> 2、从analog_point节点中读取分接头位置数据（value、quality）数据更新到节点meas中（tap、tapFlag）
>
> 3、将meas的分接头位置数据【tap】赋值给 two_tap_changer 节点的【tap_meas】属性

### 三绕组变压器【three_port_transformer】

> 1、从three_tap_changer.csv文件中读取三绕组变压器基本数据，详见属性列表。
>
> 2、从analog_point节点中读取有功功率（value、quality）、无功功率（value、quality）数据更新到节点meas中（P，PFlag）、（Q，QFlag）
>
> 3、修改三绕组变压器的额定功率（S）, 没有值的赋值为0.001
>
> 4、计算三绕组变压器【three_port_transformer】的属性【Substation、name】及变量【@Trans_voltlevel、@SubstationID】
>
> 5、计算三相绕组变压器【three_port_transformer】电阻标幺值(Rstar)、电抗标幺值(Xstar), 变比【t】设初始值1
>
> 6、计算三绕组变压器【three_port_transformer】变比【t】
>
> 7、将设备名称【name】赋值给对应的遥测节点【meas】属性【devName】
>
> 8、将遥测数据【meas】的有功【PManual、P】、无功【QManual、Q】更新到设备的属性【Pimeas、Qimeas】
>
> 9、更新三绕组变压器【three_port_transformer】的off值，将Pimeas或Qimeas的绝对值大于0.01的设备的off设置为0(闭合)
>
> 10、选择属性off为0的设备及对应CN，使用设备的连接点ID【nd】更新设备、对应CN节点的计算节点变量【@topoID】
>
> 11、生成计算节点【TopoND】
>
> 12、构建与计算节点【TopoND】的关联关系。
>
> 13、构建三相绕组变压器支路。
>
> 14、将【变压器】的额定电压更新至【非孤岛计算节点】，将变压器的名字更新至计算节点。
>
> 15、将双绕组变压器的Pimeas以（id->Pimeas）的形式保存到@@three_port_p_MapAccum变量中，将Qimeas保存到@@three_port_q_MapAccum变量中。
>
> 16、将保存在@@three_port_p_MapAccum、@@three_port_q_MapAccum更新到topo_connect的（M_P_TLPF_list，M_Q_TLPF_list）和（M_P_TLPF，M_Q_TLPF）中。
>
> 17、计算设备【trans3】对应meas的@Pflag、@Qflag变量，@Pflag = PFlag + P_ManualFlag, @Qflag = QFlag + Q_ManualFlag
>
> 18、将@Pflag以(id -> @Pflag)的形式存入@@three_port_Pflag变量中，将@Qflag以(id -> @Qflag)的形式存入@@three_port_Qflag变量中。
>
> 19、更新三绕组变压器支路topo_connect的Ri_eP、Ri_eQ属性值。

### 三头分接开关【three_tap_changer】

> 1、从three_tap_changer.csv文件中读取基本数据，详见属性列表。
>
> 2、从analog_point节点中读取分接头位置数据（value、quality）数据更新到节点meas中（tap、tapFlag）
>
> 3、将meas的分接头位置数据【tap】赋值给 three_tap_changer 节点的【tap_meas】属性

### 中性点【neutral_point】

> 1、从three_port_trans.csv文件中读取基本数据，详见属性列表。
>
> 2、生成计算节点【TopoND】及之间的关联关系【topo_neutral】
>
> 3、设置中性点【Ri_vP、Ri_vQ】的初始值。

### 开关【Breaker】

> 1、从Breaker.csv文件中读取基本数据，详见属性列表。
>
> 2、从discrete_point节点中读取开关状态数据（value、quality）数据更新到节点discrete中（status、flag）
>
> 3、设置断路器【Breaker】状态【point】初始值为1, 即：闭合
>
> 4、更新断路器【Breaker】的属性【Substation、name】
>
> 5、将设备名称【name】赋值给对应的遥信节点【discrete】属性【devName】
>
> 6、将遥信数据【discrete】的状态【statusM、status】更新到断路器【Breaker】的状态【point】
>
> 7、将遥信节点【discrete】数据更新到断路器【Breaker】属性【point】  （重复）

### 刀闸【Disconnector】

> 1、从Disconnector.csv文件中读取基本数据，详见属性列表。
>
> 2、从discrete_point节点中读取刀闸状态数据（value、quality）数据更新到节点discrete中（status、flag）
>
> 3、设置刀闸【Disconnector】状态【point】初始值为1, 即：闭合
>
> 4、更新刀闸【Disconnector】的属性【Substation、name】
>
> 5、将设备名称【name】赋值给对应的遥信节点【discrete】属性【devName】
>
> 6、将遥信数据【discrete】的状态【statusM、status】更新到刀闸【Disconnector】的状态【point】
>
> 7、将遥信节点【discrete】数据更新到刀闸【Disconnector】属性【point】  （重复）



### 接地刀闸【GroundDisconnector】

> 1、从GroundDisconnector.csv文件中读取基本数据，详见属性列表。
>
> 2、从discrete_point节点中读取接地刀闸状态数据（value、quality）数据更新到节点discrete中（status、flag）

### 变流器节点【Convertor】

### 串联补偿器【C_S】

> 1、从Compensator_S.csv文件中读取基本数据，详见属性列表。
>
> 2、计算串联电容器【C_S】的属性【cs_ZK】及变量【@Qrate、@Zk】
>
> 3、更新串联电容器【C_S】的属性【Substation、name】
>
> 4、将设备名称【name】赋值给对应的遥测节点【meas】属性【devName】
>
> 5、选择属性off为0的设备及对应CN，使用设备的连接点ID【nd】更新设备、对应CN节点的计算节点变量【@topoID】
>
> 6、构建CS传输线支路模型。
>
> 7、更新C_S支路topo_connect的Ri_eP、Ri_eQ属性值，都设为0.01

### 并联补充器【C_P】

> 1、从Compensator_P.csv文件中读取基本数据，详见属性列表。
>
> 2、使用【BaseVoltage】的【nomkV】更新【C_P】的额定电压【base_value】
>
> 3、更新并联电容器【C_P】的属性【Substation、name】
>
> 4、将设备名称【name】赋值给对应的遥测节点【meas】属性【devName】
>
> 5、将遥测数据【meas】的有功【PManual、P】、无功【QManual、Q】更新到设备的属性【Pimeas、Qimeas】
>
> 6、选择属性off为0的设备及对应CN，使用设备的连接点ID【nd】更新设备、对应CN节点的计算节点变量【@topoID】
>
> 7、生成计算节点【TopoND】
>
> 8、构建与计算节点【TopoND】的关联关系。
>
> 9、识别与ACline连接的CP(电容)，将相连电容的列表更新至支路的from_CP_list、to_CP_list属性中
>
> 10、更新支路的from_CP、to_CP属性。
>
> 11、将【电容器】的有功【P】、无功【Qmeas】、额定电压【base_value】、导纳参数更新至【非孤岛计算节点】
>
> 12、将【并联电容器】的计算节点的ZJQ的属性值设置为0
>
> 13、计算设备【CP】对应meas的@Pflag、@Qflag变量，@Pflag = PFlag + P_ManualFlag, @Qflag = QFlag + Q_ManualFlag

### 设备连接点【CN】

### 交流线路端点【ACline_dot】

> 1、从aclinedot.csv文件中读取交流线路端点基本数据，详见属性列表。
>
> 2、从BaseVoltage节点中读取nomKV更新ACline_dot节点的电压【volt】和额定电压【base_value】
>
> 3、将ACline_dot连接的变电站id赋值给相连的ACline_dot、ACline_dot对应的CN的变量@subid
>
> 4、根据ACline_dot的电阻(R)、电抗(X)、电纳(B)计算关系aclinedot_aclinedot的line_R、line_X、line_B
>
> 5、写入ACline_dot与substation的双向关联关系connected_Aclinedot_Sub、connected_Sub_Aclinedot，关联id分别为（id，@subid）、（@subid，id）
>
> 6、给ACline_dot的Subname、name赋值，name格式为：subname + "." + name
>
> 7、给两个相连ACline_dot的name分别赋值给关系aclinedot_aclinedot的I_node与J_node。
>
> 8、将设备名称【name】赋值给对应的遥测节点【meas】属性【devName】
>
> 9、将遥测数据【meas】的有功【PManual、P】、无功【QManual、Q】更新到设备的属性【Pimeas、Qimeas】
>
> 10、设置【ACline_dot】的off值：将电压等级大于500kV, 并且Pimeas与Qimeas的值都为0的AC传输线的@off设置为1(断开)、指定某些ACline_dot设置off设为1(断开)，其余默认为0。
>
> 11、选择属性off为0的设备及对应CN，使用设备的连接点ID【nd】更新设备、对应CN节点的计算节点变量【@topoID】
>
> 12、生成计算节点【TopoND】
>
> 13、构建与计算节点【TopoND】的关联关系。
>
> 14、构建AC传输线支路。
>
> 15、将电容【C_P】的无功功率量测【Qimeas】更新至与之相连的ACline_dot【@Qimeas】中
>
> 16、将ACline_dot的Pimeas以（id->Pimeas）的形式保存到@@acline_p_MapAccum变量中，将Qimeas保存到@@acline_q_MapAccum变量中。
>
> 17、将保存在@@acline_p_MapAccum、@@acline_q_MapAccum更新到topo_connect的（M_P_TLPF_list，M_Q_TLPF_list）和（M_P_TLPF，M_Q_TLPF）中。
>
> 18、将ACline_dot的【电压等级、额定电压】到计算节点的base_kV、desired_volts中。
>
> 19、计算设备【AClinedot】对应meas的@Pflag、@Qflag变量，@Pflag = PFlag + P_ManualFlag, @Qflag = QFlag + Q_ManualFlag
>
> 20、将@Pflag以(id -> @Pflag)的形式存入@@acline_Pflag变量中，将@Qflag以(id -> @Qflag)的形式存入@@acline_Qflag变量中。
>
> 21、更新AC传输线支路topo_connect的Ri_eP、Ri_eQ属性值

## 4.5.负荷类

### 负荷【l_oad】

> 1、从EnergyConsumer.csv文件中读取基本数据，详见属性列表。
>
> 2、使用【BaseVoltage】的【nomkV】更新【l_oad】的额定电压【base_value】
>
> 3、更新负荷【l_oad】的属性【Substation、name】
>
> 4、将遥测数据【meas】的有功【PManual、P】、无功【QManual、Q】更新到设备的属性【Pimeas、Qimeas】
>
> 5、设置负荷【l_oad】的off值：将"马窝换流站.1站用变" 、"马窝换流站.2站用变"负荷的off设置为1(断开)，其余默认为0
>
> 6、选择属性off为0的设备及对应CN，使用设备的连接点ID【nd】更新设备、对应CN节点的计算节点变量【@topoID】
>
> 7、生成计算节点【TopoND】
>
> 8、构建与计算节点【TopoND】的关联关系。
>
> 9、将【负荷】的有功、无功、额定电压更新至【非孤岛计算节点】，将负荷的名称更新至非孤岛计算节点。
>
> 10、将【负荷】的计算节点的ZJP(猜测为互阻抗)的属性值设置为0
>
> 11、将【负荷】的计算节点的ZJQ的属性值设置为0
>
> 12、计算设备【Load】对应meas的@Pflag、@Qflag变量，@Pflag = PFlag + P_ManualFlag, @Qflag = QFlag + Q_ManualFlag

### 历史负荷节点【load_history】



## 4.6.计算模型类

### 等值机【GeneratingUnit】



### 计算节点【TopoND】

> 1、生成设备对应的TopoND，详解具体设备内容。
>
> 2、筛选非孤岛计算节点和孤岛计算节点。
>
> 3、设置计算节点的exId属性值，该属性值为递增的值，用来对计算节点进行排序。
>
> 4、设置非孤岛计算节点的变电站名称【sub】。
>
> 5、更新电气节点Ri_V的属性值。
>
> 6、将所有TopoND之间关系数据保存到@@edge中，形式：sort_edge_NTPUpdate(s.exId\*100000 + t.exId, e.M_P_TLPF, e.M_Q_TLPF, e.Ri_eP, e.Ri_eQ, e.from_CP, e.to_CP, t.exId)
>
> 7、将所有TopoND之间节点数据保存到@@vertex中，形式：sort_vertex_NTPUpdate(s.exId, s.@alldgr, s.@M_Vm, s.@M_Va, s.@GenP, s.@GenQ, s.@LdP, s.@LdQ, s.@M_C_P)
>
> 8、调用C++函数AttrSave_NTP_update_v7将(@@vertex, @@edge)保存到对应矩阵当中。
>
> 9、设置支路导纳的实部(B)、虚部(G)、line_Q1、BIJ、变压器变比(transformer_final_turns_ratio)、hB
>
> 10、将TopoND之间关系数据保存到@@edge中，形式：sort_edge(s.exId*100000 + t.exId, e.G, e.B, e.hB, e.BIJ, e.transformer_final_turns_ratio, e.line_Q1, t.exId)
>
> 11、将所有TopoND之间节点数据保存到@@vertex中，形式：sort_vertex(s.exId, s.@alldgr, s.@xk_hB, s.G, s.B, s.busType)
>
> 12、调用C++函数AttrSave_NTP_insert将(@@vertex, @@edge)保存到对应矩阵当中。

## 4.7.属性类

### 参数【parameters】



### 参数【status】



## 量测类

### 量测节点【measurement_point】

> 1、来源于Measurement.csv文件，包含了所有量测设备的ID和类型等属性。【load_gx_data.gsql】

### 量测类型【measure_type】

遥信、遥测数据都有一个对应的量测类型。

> 1、来源于MeasurementType.csv文件，包含了量测类型ID和量测类型名称等属性。【load_gx_data.gsql】

### 遥信节点【discrete_point】

主要设备有Breaker、Disconnector、GroundDisconnector，后面数据同步到discrete节点。

> 1、量测节点数据中，meas_type == "40740" 的部分。
>
> 2、建立与measure_type的关联关系discrete_type【discrete_point - measure_type】，关联ID分别为id、meas_type。
>
> 3、建立与discrete的关联关系discrete_dev【discrete_point - discrete】，关联ID分别为id、devid。
>
> 4、给value、quality赋值，数据来源于meas_discrete.csv。

### 遥测节点【analog_point】

> 1、量测节点数据中，meas_type != "40740" 的部分。
>
> 2、建立与measure_type的关联关系analog_type【analog_point - measure_type】，关联ID分别为id、meas_type。
>
> 3、建立与meas的关联关系analog_dev【analog_point - meas】，关联ID分别为【id、devid】、【id，terminal】。
>
> 4、给value、quality赋值，数据来源于meas_analog.csv。



### 遥信节点【discrete】

> 1、将设备的值从discrete_point更新到设备对应的discrete，详解具体设备。

### 遥测节点【meas】

> 1、将设备的值从analog_point更新到设备对应的meas，详解具体设备。
>
> 2、将所有的遥测节点【meas】的属性【meas_A】设置为1, 属性【meas_B】设置为0

### 历史量测节点【meas_history】



## 其他

### Maintorg



### Powergrid



### Gridcom



### dcc



### carbon_history

