# Schema构建



# 数据加载



# 拓扑分析



# 母线支路模型

## 节点赋值

**设备一：**母线、负荷、双绕组/三绕组变压器、ac传输线端、并联电容

| 序号 |    计算节点属性    |  设备一   |  发电机   |   中性点    |
| :--: | :----------------: | :-------: | :-------: | :---------: |
|  1   |       topoid       |  @topoID  |  @topoID  | middlepoint |
|  2   |       TOPOID       |  @topoID  |  @topoID  | middlepoint |
|  3   |       exIdU        |           |           |             |
|  4   |       island       |           |           |             |
|  5   |      bus_name      |   name    |   name    |    name     |
|  6   |        area        |           |           |             |
|  7   |     loss_zoneU     |           |           |             |
|  8   |      busType       |           |           |             |
|  9   |         Vm         |           |           |             |
|  10  |         Va         |           |           |             |
|  11  |       cal_Vm       |           |           |             |
|  12  |       cal_Va       |           |           |             |
|  13  |        M_Vm        |           |           |             |
|  14  |        M_Va        |           |           |             |
|  15  |        Ri_V        |           |           |             |
|  16  |      base_kV       |   volt    |   volt    |      1      |
|  17  |   desired_volts    | basevalue | basevalue |      1      |
|  18  | control_bus_number |           |           |             |
|  19  |        up_V        |    1.1    |    1.1    |     1.1     |
|  20  |        lo_V        |    0.9    |    0.9    |     0.9     |
|  21  |        GenP        |           |           |             |
|  22  |        GenQ        |           |           |             |
|  23  |      M_Gen_P       |           |           |             |
|  24  |      M_Gen_Q       |           |           |             |
|  25  |        qUp         |           | Qmax/100  |             |
|  26  |       qLower       |           | Qmin/100  |             |
|  27  |        LdP         |           |           |             |
|  28  |        LdQ         |           |           |             |
|  29  |         P          |           |           |             |
|  30  |         Q          |           |           |             |
|  31  |       cal_P        |           |           |             |
|  32  |       cal_Q        |           |           |             |
|  33  |      M_Load_P      |           |           |             |
|  34  |      M_Load_Q      |           |           |             |
|  35  |         G          |           |           |             |
|  36  |         B          |           |           |             |
|  37  |        Sub         |           |           |             |
|  38  |     longitude      |           |           |             |
|  39  |      latitude      |           |           |             |
|  40  |         OV         |           |           |             |
|  41  |         UV         |           |           |             |
|  42  |       Ri_vP        |     0     |     0     |      0      |
|  43  |       Ri_vQ        |     0     |     0     |      0      |
|  44  |        sumB        |           |           |             |
|  45  |        sumG        |           |           |             |
|  46  |       sumBi        |           |           |             |
|  47  |        volt        |           |           |             |
|  48  |       pos_x        |           |           |             |
|  49  |       pos_y        |           |           |             |
|  50  |       SE_Vm        |           |           |             |
|  51  |       SE_Va        |           |           |             |
|  52  |       PF_Vm        |           |           |             |
|  53  |       PF_Va        |           |           |             |
|  54  |       M_C_P        |           |           |             |
|  55  |      start_pt      |     0     |     0     |      0      |
|  56  |     outdegree      |           |           |             |
|  57  |       nodeSI       |    0.0    |    0.0    |     0.0     |
|  58  |   node_SI_order    |           |           |             |
|  59  |   nodeCSeverity    |    0.0    |    0.0    |     0.0     |
|  60  |        ZJP         |     1     |     1     |      1      |
|  61  |        ZJQ         |     1     |     1     |      1      |
|  62  |       xk_hB        |           |           |             |
|  63  |         x          |           |           |             |
|  64  |         y          |           |           |             |



## 支路赋值

| 序号 |              支路属性              |   串联电容器   |         AC线<br />（line_R < 0）         |        AC线<br />（line_R >= 0）        |       双绕组变压器（Rstar < 0）        |   双绕组变压器<br />（Rstar >= 0）    |    三绕组变压器<br />（Rstar < 0）     |   三绕组变压器<br />（Rstar >= 0）    |
| :--: | :--------------------------------: | :------------: | :--------------------------------------: | :-------------------------------------: | :------------------------------------: | :-----------------------------------: | :------------------------------------: | :-----------------------------------: |
|  1   |                FROM                |      @iid      |                 @topoID                  |                 @topoID                 |                @topoID                 |                @topoID                |                @topoID                 |                @topoID                |
|  2   |                 TO                 |      @jid      |                 @topoID                  |                 @topoID                 |                @topoID                 |                @topoID                |              middlepoint               |              middlepoint              |
|  3   |             edge_name              |      name      |                   name                   |                  name                   |                  name                  |                 name                  |                  name                  |                 name                  |
|  4   |                area                |      name      |                   name                   |                  name                   |                  name                  |                 name                  |                  name                  |                 name                  |
|  5   |                zone                |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  6   |              tap_bus               |      @iid      |                 @topoID                  |                 @topoID                 |                @topoID                 |                @topoID                |                @topoID                 |                @topoID                |
|  7   |               z_bus                |      @jid      |                 @topoID                  |                 @topoID                 |                @topoID                 |                @topoID                |              middlepoint               |              middlepoint              |
|  8   |                flag                |                |                    0                     |                    0                    |                   1                    |                   1                   |                   1                    |                   1                   |
|  9   |                 R                  |       0        |                  -lineR                  |                  lineR                  |                 -Rstar                 |                 Rstar                 |                 -Rstar                 |                 Rstar                 |
|  10  |                 X                  |      csZK      |                  lineX                   |                  lineX                  |                 Xstar                  |                 Xstar                 |                 Xstar                  |                 Xstar                 |
|  11  |              hB_list               |                |                  lineB                   |                  lineB                  |                   0                    |                   0                   |                   0                    |                   0                   |
|  12  |            line_Q1_list            |      200       |               normalLimit                |               normalLimit               |              normalLimit               |              normalLimit              |              normalLimit               |              normalLimit              |
|  13  |            line_Q2_list            |      250       |                emerLimit                 |                emerLimit                |               emerLimit                |               emerLimit               |               emerLimit                |               emerLimit               |
|  14  |            line_Q3_list            |      300       |                ldshdLimit                |               ldshdLimit                |               ldshdLimit               |              ldshdLimit               |               ldshdLimit               |              ldshdLimit               |
|  15  |            control_bus             |                |                    0                     |                    0                    |                                        |                                       |                                        |                                       |
|  16  |                side                |                |                    0                     |                    0                    |                                        |                                       |                                        |                                       |
|  17  | transformer_final_turns_ratio_list |                |                                          |                                         |                tapratio                |               tapratio                |             tapratiothree              |             tapratiothree             |
|  18  |      transformer_final_angle       |                |                                          |                                         |                   0                    |                   0                   |                   0                    |                   0                   |
|  19  |              min_tap               |                |                    0                     |                    0                    |                 itapL                  |                 itapL                 |                 itapL                  |                 itapL                 |
|  20  |              max_tap               |                |                    0                     |                    0                    |                 itapH                  |                 itapH                 |                 itapH                  |                 itapH                 |
|  21  |             step_size              |                |                    0                     |                    0                    |                 itapC                  |                 itapC                 |                 itapC                  |                 itapC                 |
|  22  |              min_volt              |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  23  |              max_volt              |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  24  |           M_P_TLPF_list            |                |                Pimeas/100                |               Pimeas/100                |               Pimeas/100               |              Pimeas/100               |               Pimeas/100               |              Pimeas/100               |
|  25  |           M_Q_TLPF_list            |                |                Qimeas/100                |               Qimeas/100                |               Qimeas/100               |              Qimeas/100               |               Qimeas/100               |              Qimeas/100               |
|  26  |                 th                 |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  27  |                 em                 |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  28  |                 sh                 |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  29  |               outage               |                |                    0                     |                    0                    |                   0                    |                   0                   |                   0                    |                   0                   |
|  30  |               G_list               |                | -lineR / (lineR * lineR + lineX * lineX) | lineR / (lineR * lineR + lineX * lineX) | -Rstar/(Rstar * Rstar + Xstar * Xstar) | Rstar/(Rstar * Rstar + Xstar * Xstar) | -Rstar/(Rstar * Rstar + Xstar * Xstar) | Rstar/(Rstar * Rstar + Xstar * Xstar) |
|  31  |               B_list               |     1/csZK     | lineX / (lineR * lineR + lineX * lineX)  | lineX / (lineR * lineR + lineX * lineX) | Xstar/(Rstar * Rstar + Xstar * Xstar)  | Xstar/(Rstar * Rstar + Xstar * Xstar) | Xstar/(Rstar * Rstar + Xstar * Xstar)  | Xstar/(Rstar * Rstar + Xstar * Xstar) |
|  32  |              BIJ_list              |     1/csZK     |                1 / lineX                 |                1 / lineX                |                1/Xstar                 |                1/Xstar                |                1/Xstar                 |                1/Xstar                |
|  33  |              circuit               |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  34  |               kcount               |                |               @aclinecount               |              @aclinecount               |                   1                    |                   1                   |                   1                    |                   1                   |
|  35  |               P_TLPF               |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  36  |               Q_TLPF               |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  37  |               hbsum                |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  38  |               Ri_eP                |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  39  |               Ri_eQ                |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  40  |                 CI                 |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  41  |              reverse               |       1        |                nonreverse                |               nonreverse                |               nonreverse               |              nonreverse               |                   1                    |                   1                   |
|  42  |            tap_type_id             |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  43  |             CA_bridge              |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  44  |           mainland_side            |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  45  |             CA_solver              |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  46  |              Decision              |       0        |                    0                     |                    0                    |                   0                    |                   0                   |                   0                    |                   0                   |
|  47  |         Analysis_decision          |       0        |                    0                     |                    0                    |                   0                    |                   0                   |                   0                    |                   0                   |
|  48  |                 SI                 |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  49  |                volt                | ToString(volt) |              ToString(volt)              |             ToString(volt)              |     ToString(volt)-ToString(volt)      |    ToString(volt) - ToString(volt)    |             ToString(volt)             |            ToString(volt)             |
|  50  |            device_type             |    CS传输线    |                 AC传输线                 |                AC传输线                 |              双绕组变压器              |             双绕组变压器              |              三绕组变压器              |             三绕组变压器              |
|  51  |            from_busname            |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  52  |             to_busname             |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  53  |             CSeverity              |       -1       |                    -1                    |                   -1                    |                   -1                   |                  -1                   |                   -1                   |                  -1                   |
|  54  |                 hB                 |                |                  lineB                   |                  lineB                  |                   0                    |                   0                   |                   0                    |                   0                   |
|  55  |                 G                  |                | -lineR / (lineR * lineR + lineX * lineX) | lineR / (lineR * lineR + lineX * lineX) | -Rstar/(Rstar * Rstar + Xstar * Xstar) | Rstar/(Rstar * Rstar + Xstar * Xstar) | -Rstar/(Rstar * Rstar + Xstar * Xstar) | Rstar/(Rstar * Rstar + Xstar * Xstar) |
|  56  |                 B                  |     1/csZK     | lineX / (lineR * lineR + lineX * lineX)  | lineX / (lineR * lineR + lineX * lineX) | Xstar/(Rstar * Rstar + Xstar * Xstar)  | Xstar/(Rstar * Rstar + Xstar * Xstar) | Xstar/(Rstar * Rstar + Xstar * Xstar)  | Xstar/(Rstar * Rstar + Xstar * Xstar) |
|  57  |                BIJ                 |     1/csZK     |                1 / lineX                 |                1 / lineX                |                1/Xstar                 |                1/Xstar                |                1/Xstar                 |                1/Xstar                |
|  58  |   transformer_final_turns_ratio    |                |                                          |                                         |                tapratio                |               tapratio                |             tapratiothree              |             tapratiothree             |
|  59  |              M_P_TLPF              |                |                Pimeas/100                |               Pimeas/100                |               Pimeas/100               |              Pimeas/100               |               Pimeas/100               |              Pimeas/100               |
|  60  |              M_Q_TLPF              |                |                Qimeas/100                |               Qimeas/100                |               Qimeas/100               |              Qimeas/100               |               Qimeas/100               |              Qimeas/100               |
|  61  |              line_Q1               |      200       |               normalLimit                |               normalLimit               |              normalLimit               |              normalLimit              |              normalLimit               |              normalLimit              |
|  62  |              line_Q2               |      250       |                emerLimit                 |                emerLimit                |               emerLimit                |               emerLimit               |               emerLimit                |               emerLimit               |
|  63  |              line_Q3               |      300       |                ldshdLimit                |               ldshdLimit                |               ldshdLimit               |              ldshdLimit               |               ldshdLimit               |              ldshdLimit               |
|  64  |              SI_order              |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  65  |              key_list              |                |                    id                    |                   id                    |                   id                   |                  id                   |                   id                   |                  id                   |
|  66  |              from_off              |       0        |                    0                     |                    0                    |                   0                    |                   0                   |                   0                    |                   0                   |
|  67  |               to_off               |       0        |                    0                     |                    0                    |                   0                    |                   0                   |                   0                    |                   0                   |
|  68  |            from_CP_list            |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  69  |              from_CP               |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  70  |             to_CP_list             |                |                                          |                                         |                                        |                                       |                                        |                                       |
|  71  |               to_CP                |                |                                          |                                         |                                        |                                       |                                        |                                       |



# 状态估计

（1）获取母线-支路模型

（2）计算导纳，形成增益矩阵GainP、GainQ、GainP_p、GainQ_q等

（3）增益矩阵因式分解GainMatrix_factorize_static

（4）求解自由向量所需参数初始化Cal_parameter_V7

（5）通过状态变量和网络参数计算得到 @@H_r_P、@@H_r_Q自由向量Cal_HrPQ_V7

（6）有功、相角求解，返回更新后的电压相角以及最大的电压相角变化量SE_solve_GainP_static

（7）无功、电压求解，返回更新后的电压幅值以及最大的电压幅值变化量SE_solve_GainQ_static

（8）最大电压幅值变化量小于收敛精度或最大电压相角变化量小于收敛精度或迭代次数大于最大迭代次数（是：9、否：5）

（9）状态估计结果更新至计算节点



# 潮流计算

## 潮流计算-start

（1）迭代参数设置

（2）判断修正方程系数矩阵是否LU分解

 

## 未进行LU分解

计算PQ分解法的修正方程系数矩阵parameter_fdpf_factorize_v2

 

（1）LU分解及潮流计算GRAPHLU_fdpf_LU_factorize_EMS_rpi_cp_v2

（1.1）对PQ分解法的修正方程系数矩阵进行LU分解

（1.2）基于电压幅值、电压相角计算有功、无功误差

（1.3）基于有功、无功误差求解修正方程，得到电压幅值、电压相角的更新量，更新电压幅值和电压相角

（1.4）最大有功功率误差小于收敛精度、或最大无功功率误差小于收敛精度、或迭代次数大于最大迭代次数【是：1.2】

 

## 已进行LU分解

获取状态估计的结果Vm, Va, P, Q

 

（1）潮流计算GRAPHLU_fdpf_LU_solve_EMS

（1.1）从内存中获取PQ分解法的修正方程系数矩阵LU分解后的结果

（1.2）基于电压幅值、电压相角计算有功、无功误差

（1.3）基于有功、无功误差求解修正方程，得到电压幅值、电压相角的更新量，更新电压幅值和电压相角

（1.4）最大有功功率误差小于收敛精度、或最大无功功率误差小于收敛精度、或迭代次数大于最大迭代次数【是：1.2】

 

## 潮流计算-end

（1）获取潮流计算的电压幅值GRAPHLU_getVm_EMS

（2）获取潮流计算的电压相角GRAPHLU_getVa_EMS

（3）将潮流计算结果（有功、无功功率）更新至计算节点与边