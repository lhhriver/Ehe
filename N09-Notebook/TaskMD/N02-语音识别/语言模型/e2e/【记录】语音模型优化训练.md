# 容器准备

## 加载镜像

```shell
# 133
cd  /wp/aster/zhongke/onephase/
ll
```

```
total 22312456
-rw------- 1 root root 22847950336 Apr 27  2022 gpu-cuda10.1-cudnn7-u18-local-espnet-nw-v310.tar
```

加载镜像文件：**gpu-cuda10.1-cudnn7-u18-local-espnet-nw-v310.tar**

```shell
docker load -i gpu-cuda10.1-cudnn7-u18-local-espnet-nw-v310.tar 
```

```
...
Loaded image: 172.16.128.226:8888/library/gpu-cuda10.1-cudnn7-u18-local-espnet-nw:v3.10
```



```shell
docker images | grep espnet
```

```
172.16.128.226:8888/library/gpu-cuda10.1-cudnn7-u18-local-espnet-nw     v3.10    f387ce771a63     6 months ago    22.7GB
```



```shell
docker tag f387ce771a63 ehe_local_espnet_ts:v1.0
docker images | grep espnet
```

```
172.16.128.226:8888/library/gpu-cuda10.1-cudnn7-u18-local-espnet-nw   v3.10               f387ce771a63        6 months ago        22.7GB
ehe_local_espnet_ts                                                   v1.0                f387ce771a63        6 months ago        22.7GB
```



## 启动容器

```shell
# 193
NV_GPU='0,1'  nvidia-docker run --ipc=host --name Ehe_ts_finetune_env -dit  --entrypoint="/bin/bash" f387ce771a63
```

```shell
NV_GPU='0,1'  nvidia-docker run --ipc=host --name ehe-finetune-ts -it -d -v /data/thinkit_train:/data/thinkit_train --entrypoint="/bin/bash" f387ce771a63
```



```shell
# 193
docker ps | grep Ehe_ts_finetune_env
```

```
dc0da8f84f48    f387ce771a63   "/bin/bash"   5 days ago   Up 5 days   Ehe_ts_finetune_env
```



```bash
docker exec -it dc0da8f84f48 /bin/bash
```



# 语言模型训练

## 端到端语言模型训练

> **位置**：147：/data/thinkit_train/CorpusBasedLMtrain_v2.0_utf8.tar.gz
>
> **位置**：193：/home/Ehe/lm/CorpusBasedLMtrain_v2.0_utf8.tar.gz

1、将e2e训练环境代码copy到容器内

```shell
# 193:/home/Ehe/lm
tar -zxvf CorpusBasedLMtrain_v2.0_utf8.tar.gz 
```

```shell
docker cp CorpusBasedLMtrain_v2.0_utf8  Ehe_ts_finetune_env:/ai_home/workspace/e2e_lm/
```

2、详见：【离线】基于标注文本的语音模型优化训练指南

## 混合语音模型训练

> **位置**：193://home/Ehe/lm/CorpusBasedLMtrain_utf8.tar.gz

1、将hybrid训练环境代码copy到容器内

```shell
# 193:/home/Ehe/lm
tar -zxvf CorpusBasedLMtrain_utf8.tar.gz
```

```
docker cp CorpusBasedLMtrain_utf8  Ehe_ts_finetune_env:/ai_home/workspace/e2e_lm/
```

