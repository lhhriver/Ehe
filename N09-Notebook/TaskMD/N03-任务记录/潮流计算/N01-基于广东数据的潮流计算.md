# gsql代码执行

**步骤一：**命令行依次执行

```shell
gsql -g gsql_EMS create_GXPF_example_schema.gsql
gsql -g gsql_EMS load_gd_data.gsql

gsql -g gsql_EMS initiateMeasPoint.gsql
gsql -g gsql_EMS 'install query initiateMeasPoint'
gsql -g gsql_EMS 'run query initiateMeasPoint()'

gsql -g gsql_EMS load_meas.gsql
gsql -g gsql_EMS load_state_grid_flow.gsql
```



**步骤二：**执行脚本run_gsql.sh，脚本内容如下

```shell
 gsql -g gsql_EMS CIME_initial.gsql
 gsql -g gsql_EMS virtualbusInit.gsql
 gsql -g gsql_EMS tlineInit.gsql
 gsql -g gsql_EMS topocheck.gsql
 gsql -g gsql_EMS analog_discrete_update_all.gsql
 gsql -g gsql_EMS setValue.gsql
 
 gsql -g gsql_EMS NTP_EMS_insert.gsql
 gsql -g gsql_EMS NTP_EMS_sub_info.gsql
 
 gsql -g gsql_EMS NTP_EMS_update_init_pre.gsql # pre
 gsql -g gsql_EMS NTP_EMS_update_init.gsql  
 
 gsql -g gsql_EMS preprocessing.gsql
```

命令行执行：

```shell
gsql -g gsql_EMS "install query all"
```



**步骤三：**前端依次执行

```shell
 gsql -g gsql_EMS 'run query CIME_initial()'
 gsql -g gsql_EMS 'run query virtualbusInit()'
 gsql -g gsql_EMS 'run query tlineInit()'
 gsql -g gsql_EMS 'run query topocheck()'
 gsql -g gsql_EMS 'run query analog_discrete_update_all()'
 gsql -g gsql_EMS 'run query setValue()'
 gsql -g gsql_EMS 'run query NTP_EMS_insert()'
 gsql -g gsql_EMS 'run query NTP_EMS_sub_info()'
 gsql -g gsql_EMS 'run query NTP_EMS_update_init()'
 gsql -g gsql_EMS 'run query preprocessing()'
```



**步骤四：**执行shell脚本run_gsql_2.sh，脚本内容如下

```shell
 gsql -g gsql_EMS state_estimation_weight_gain.gsql
 gsql -g gsql_EMS state_estimation_weight_solve_v7.gsql
 gsql -g gsql_EMS state_estimation_result_update.gsql
 gsql -g gsql_EMS FDPF_EMS.gsql
 gsql -g gsql_EMS power_flow_result_update.gsql
 gsql -g gsql_EMS fastscreen_static.gsql
 gsql -g gsql_EMS ca_detailedPF.gsql
```

命令行执行：

```shell
 gsql -g gsql_EMS "install query all"
```



**步骤五：**前端依次执行

```shell
 gsql -g gsql_EMS 'run query state_estimation_weight_gain()'
 gsql -g gsql_EMS 'run query state_estimation_weight_solve_v7()'
 gsql -g gsql_EMS 'run query state_estimation_result_update()' 
 gsql -g gsql_EMS 'run query FDPF_EMS(1)'
 gsql -g gsql_EMS 'run query power_flow_result_update()'
 #gsql -g gsql_EMS 'run query fastscreen_static(1)'
 #gsql -g gsql_EMS 'run query ca_detailedPF()'
```



**重启：**

```shell
 gsql -g gsql_EMS 'run query analog_discrete_update_all()'
 gsql -g gsql_EMS 'run query dengzhi()'
 gsql -g gsql_EMS 'run query NTP_EMS_delete()'
 gsql -g gsql_EMS 'run query setValue()'
 gsql -g gsql_EMS 'run query NTP_EMS_insert()'
 gsql -g gsql_EMS 'run query NTP_EMS_sub_info()'
 gsql -g gsql_EMS 'run query NTP_EMS_update_init()'
 gsql -g gsql_EMS 'run query preprocessing()'
 gsql -g gsql_EMS 'run query state_estimation_weight_gain()'
 gsql -g gsql_EMS 'run query state_estimation_weight_solve_v7()'
 gsql -g gsql_EMS 'run query state_estimation_result_update()' 
 gsql -g gsql_EMS 'run query FDPF_EMS(1)'
 gsql -g gsql_EMS 'run query power_flow_result_update()'
 #gsql -g gsql_EMS 'run query fastscreen_static(1)'
 #gsql -g gsql_EMS 'run query ca_detailedPF()'
```





# 广东sql执行

```shell
# 1、创建数据库
# create graph gd_graph

# 2、构建schema及gsql写入
# cd ExportedGraph
# gsql -g gd_graph DBImportExport_gsql_EMS.gsql

# cd ../query_code
# gsql -g gd_graph NTP_EMS_update_init_pre.gsql

# gsql -g gd_graph "install query all"

# 3、数据载入（数据为空）
cd ../update_gsql
gsql -g gd_graph loadflow_EMS_guangdong_newdata.gsql
gsql -g gd_graph load_meas_guangdong_newdata.gsql
gsql -g gd_graph load_gridcom_guangdong_newdata.gsql

# 其他
gsql -g gd_graph 'run query CIME_initial()'
gsql -g gd_graph 'run query virtualbusInit()'
gsql -g gd_graph 'run query tlineInit()'

gsql -g gd_graph 'run query topocheck()'
gsql -g gd_graph 'run query analog_discrete_update_all()'
gsql -g gd_graph 'run query setValue()'
gsql -g gd_graph 'run query NTP_EMS_insert()'
gsql -g gd_graph 'run query NTP_EMS_sub_info()'
gsql -g gd_graph 'run query NTP_EMS_update_init_pre()'
gsql -g gd_graph 'run query NTP_EMS_update_init()'

gsql -g gd_graph 'run query topocheck()'
gsql -g gd_graph 'run query NTP_EMS_insert()'
gsql -g gd_graph 'run query NTP_EMS_sub_info()'
gsql -g gd_graph 'run query NTP_EMS_update_init_pre()'
gsql -g gd_graph 'run query NTP_EMS_update_init()'

gsql -g gd_graph 'run query preprocessing()'
gsql -g gd_graph 'run query state_estimation_weight_gain()'
gsql -g gd_graph 'run query state_estimation_weight_solve_v7()'

gsql -g gd_graph 'run query NTP_EMS_update_init()'
gsql -g gd_graph 'run query preprocessing()'
gsql -g gd_graph 'run query state_estimation_weight_gain()'
gsql -g gd_graph 'run query state_estimation_weight_solve_v7()'
```



```shell
# 1、创建数据库
# create graph gd_graph

# 2、构建schema及gsql写入
# cd ExportedGraph
# gsql -g gd_graph DBImportExport_gsql_EMS.gsql
# gsql -g gd_graph "install query all"

# 3、数据载入（数据为空）
cd update_gsql
gsql -g gd_graph loadflow_EMS_guangdong_newdata.gsql
gsql -g gd_graph load_meas_guangdong_newdata.gsql
gsql -g gd_graph load_gridcom_guangdong_newdata.gsql

# 其他
gsql -g gd_graph 'run query CIME_initial()'
gsql -g gd_graph 'run query virtualbusInit()'
gsql -g gd_graph 'run query tlineInit()'

gsql -g gd_graph 'run query topocheck()'
gsql -g gd_graph 'run query analog_discrete_update_all()'
gsql -g gd_graph 'run query setValue()'
gsql -g gd_graph 'run query NTP_EMS_insert()'
gsql -g gd_graph 'run query NTP_EMS_sub_info()'
gsql -g gd_graph 'run query NTP_EMS_update_init_pre()'
gsql -g gd_graph 'run query NTP_EMS_update_init()'

# gsql -g gd_graph 'run query topocheck()'
# gsql -g gd_graph 'run query NTP_EMS_insert()'
# gsql -g gd_graph 'run query NTP_EMS_sub_info()'
# gsql -g gd_graph 'run query NTP_EMS_update_init_pre()'
# gsql -g gd_graph 'run query NTP_EMS_update_init()'

gsql -g gd_graph 'run query preprocessing()'
gsql -g gd_graph 'run query state_estimation_weight_gain()'
gsql -g gd_graph 'run query state_estimation_weight_solve_v7()'

gsql -g gd_graph 'run query NTP_EMS_update_init()'
gsql -g gd_graph 'run query preprocessing()'
gsql -g gd_graph 'run query state_estimation_weight_gain()'
gsql -g gd_graph 'run query state_estimation_weight_solve_v7()'
```



# 结果对比

|            对比项             | 远景  | 自研  |
| :---------------------------: | :---: | :---: |
|           总节点数            | 88108 | 88316 |
|          孤岛节点数           | 10349 | 10693 |
|  SE_Vm在区间 [0.8, 0.9）数量  |  23   | 10589 |
|  SE_Vm在区间 [0.9, 1.0）数量  | 10193 |  55   |
|  SE_Vm在区间 [1.0, 1.1）数量  |  133  |   2   |
|  SE_Vm在区间 [1.1, 1.2）数量  |   0   |   1   |
|                               |       |       |
|  SE_Va在区间 [-1,- 0.4）数量  |   2   |  70   |
| SE_Va在区间 [-0.4, -0.2）数量 | 2181  | 2713  |
|  SE_Va在区间 [-0.2, 0）数量   | 3551  | 2872  |
|   SE_Va在区间 [0, 0.2）数量   | 2396  | 3202  |
|  SE_Va在区间 [0.2, 0.4）数量  | 1423  |  767  |
|   SE_Va在区间 [0.4, 1）数量   |  796  | 1069  |

