公式和函数的应用

本章引语

每个笨蛋都会从自己的教训中吸取经验，聪明人则从别人的经验中获益！

——俾斯麦

同花顺中的公式和函数就是专业投资者从大量的失败教训、成功经验中总结出来的精华，合理运用公式和函数可以让我们从别人的经验中获益。

本章要点

★ 同花顺公式管理器与公式编辑

★ 同花顺公式编写的规则

★ 同花顺的常用函数

33.1 同花顺公式管理

同花顺软件将公式的各项功能及操作集中在【公式管理】中，通过【公式管理】投资者可以新建公式、查看或删除已有的公式等。

选择【工具】【公式管理】菜单命令，即可打开【公式管理】对话框，如下图所示。

【公式管理】对话框有3个选项卡，分别是【全部】、【常用】和【用户】。

【全部】：该选项卡中显示了同花顺软件的所有公式，包括【技术指标】、【五彩K线】、【自定公式】、【条件选股】和【交易系统】，鼠标单击这些公式前的“＋”按钮，可展开子目录，如下图所示。

【常用】：常用选项卡主要显示了常用的公式，同花顺默认的都是技术指标公式，如下图所示。

【用户】：该选项卡用于显示用户自定义的公式，如下图所示。

1．添加常用公式

在同花顺软件中，用户可以根据使用习惯删除或添加常用公式，下面通过将【五彩K线】中的【W-01 早晨之星】添加到【常用】选项卡为例，来介绍设置常用公式的基本步骤。

1　在【公式管理】对话框中选择【五彩K线】【W-01 早晨之星】，然后单击对话框右侧的【设为常用】按钮，如下图所示。

单击【常用】选项卡，可以看到【W01 早晨之星】已经存在列表框中了，如下图所示。

2．导出公式

使用【公式管理】对话框中的【导入】、【导出】按钮可以将公式导入或导出系统，下面以将【条件选股】中【财务选股】中的【fx C-06 主营利润选股（系统）】导出为例，来介绍将公式导出系统的具体操作步骤。

1　选择【全部】【条件选股】【财务选股】【高级选股】【 fx C-06 主营利润选股（系统）】按钮，如下图所示。

2　单击【导出】按钮，弹出【导入导出对话框模板】对话框，单击【浏览】按钮，选择导出公式的放置位置和文件名称，如下图所示。

3　单击【下一步】按钮，选择需要导出的选项，如下图所示。

4　单击【下一步】按钮，弹出导出进度对话框，当导出完成后，单击【完成】按钮即可。

公式编写规则

同花顺软件中，所有的公式系统都是遵守统一的运算法则、统一的格式进行函数之间的计算。本节将介绍在编写公式过程中应注意哪些原则。

33.2.1 公式的构成

所有的公式体由若干语句按照一定的格式组成，每个语句表示一个计算结果。根据各个语句的功能，可以将公式分为两大类语句：赋值语句和中间表达式。

1．赋值语句

赋值语句的形式为：

a=b：将b的值赋予a

每个语句可以有一个名称，该名称写在语句的最前面，并用一个冒号或等号将它与语句分割开来。在赋值语句中，常用的运算符及其功能如下表所示。

赋值语句符号表

赋值语句与赋值语句之间用分号隔开，如下所示为成本价均线的技术指标公式：

AMV0：=VOL*（OPEN＋CLOSE）/2
AMV1：SUM（AMV0，M1）/SUM（VOL，M1）；
AMV2：SUM（AMV0，M2）/SUM（VOL，M2）；
AMV3：SUM（AMV0，M3）/SUM（VOL，M3）；
AMV4：SUM（AMV0，M4）/SUM（VOL，M4）；2．中间语句
一个语句如果不需要显示，可以将它定义为中间语句。使用中间语句可以有效降低公式的书写难度，还可以将需要重复使用的语句定义成中间语句以减少计算量。每个公式最多可以分6个语句，中间语句数量没有限制，所有语句之间需要使用分号隔开。
中间语句用“：=”代替冒号，其他与一般语句完全一样。例如，上例中的成本价均线的技术指标公式中的第一句“AMV0：=VOL*（OPEN＋CLOSE）/2”，就不会被系统辨认为是指标线。

33.2.2 公式的运算符

公式的运算符将函数连接成为公式，分为算术运算符和逻辑运算符两种。

1．算术运算符

算术运算符包括“＋”“-”“*”“/”，它们分别对计算符两边的数据进行加减乘除计算，这与一般意义上的算术计算没有什么区别。

2．逻辑运算符

逻辑运算符有8种，具体如下表所示。

数据引用

公式中的基本数据来源于接收的每日行情数据，这些数据是由行情函数从数据库中按照一定的方式提取。在进行数据引用的过程中，应对如下知识进行了解。

1．数据类型

按照公式使用的数据类型，系统可以处理的数据分为变量和常量两种。所谓变量，就是一个随着时间变化而变化的数据。例如价格就是一个变量，因为每一时刻的成交价都在不停地变化。常量就是永远不变的数据，例如数值5就是一个常量。

2．指标数据引用

在编写公式的过程中，有时候需要使用另外一个指标的值。如果重新编写这个指标显得太麻烦，此时就可以调用其他指标公式直接使用，无须重新编写。
引用其他指标公式的格式为：“指标，指标线”（参数）。

对引用其他指标公式的格式进行如下说明：

指标和指标线之间用逗号隔开，一个指标不一定只有一条指标线，如果缺失，则表示引用最后一条指标线。

参数在表达式的末尾，必须用括号括起来，参数之间用逗号分开，通过参数设置可以选择设定该指标的参数，如果参数缺失，则表示使用该指标的默认参数设置。

整个表达式用引号引在其中，除参数外。例如：“MACD，DEA”（25，10，5）表示计算MACD指标的DEA指标线，计算参数为25、10、5；“MACD”（25，10，5）表示该指标的最后一条指标线，计算参数是25、10、5；“MACD”表示该指标的最后一条指标线并且使用公式的默认参数。

3．其他股票数据引用

使用以下的格式可以在当前的分析界面下引用大盘的数据或其他个股的数据实现横向上的对比。

引用大盘数据：引用大盘数据时可以使用INDEXC或NDEXV函数等。

引用个股数据：引用个股数据时使用“股票代码$数据”的格式。例如：“600019$VOL”表示“600019”这个股票本周的成交量。“999998$CLOSE”同样也可以表示为A股指数本周的收盘价，此时的A股指数被视为一只个股。

33.3 函数简介

同花顺的公式编写系统为用户提供了24类约300个函数，不同类型的函数具有不同的含义。本节着重对其中常用的几类函数进行简单介绍。

33.3.1 行情函数

行情函数主要是获取基本数据，一般无参数。行情函数的名称及含义如下表所示。

动态行情函数含义见下表。

续表

33.3.2 大盘函数

大盘函数主要用来获取同期内大盘的相关信息。常用的大盘函数如下表所示。

时间函数

常用的时间函数如下表所示。

33.3.4 引用函数

引用函数一般用于对一定周期内的数据进行计算统计。常用的引用函数如下表所示。

算术函数

算术函数主要用于对指定的数据进行求值运算，常用的算术函数如下表所示。

续表

33.3.6 指标函数

常用的指标函数如下表所示。

财务函数

常用的财务函数如下表所示。

续表

33.4 公式应用实战

通过【公式编辑】可以创建和修改6类公式：技术指标公式、条件选股公式、五彩K线公式、自定公式、预警公式和交易系统公式。【公式编辑】的编辑公式的具体操作步骤如下。

1　选择【工具】【公式管理】菜单命令，在打开【公式管理】对话框右侧单击【新建】按钮，弹出【新建】对话框，如下图所示。

2　选择【技术指标】选项，然后单击【确定】后弹出【公式编辑—技术指标】对话框，如下图所示。



在【公式编辑—技术指标】对话框中输入公式名称和描述，接下来对参数进行定义并在编辑器中输入代码，如下图所示。

4　单击【曲线属性】按钮，弹出【普通曲线高级设置】对话框，单击【坐标类型】选项卡，选择【主图坐标】，如下图所示。

　单击【确认】按钮，返回【公式编辑—技术指标】对话框，然后单击【确定】按钮保存编写的指标公式。返回【公式管理】对话框中，单击【用户】选项卡，并依此展开【技术指标】【指定指标】，即可看到刚编辑的公式已经保存到技术指标公式中了，如下图所示。

6　将同花顺软件界面切换到K线图中，然后单击鼠标右键，在弹出的快捷菜单中选择【常用指标】【JXXT】，如下图所示。

选择【JXXT】指标后，系统将用自编的技术指标显示均线，如下图所示。

8　在叠加的K线单击鼠标右键，将弹出快捷菜单，如下图所示。

9　在弹出的快捷菜单上单击【修改指标参数】选项，将弹出【技术指标参数设置】对话框，在对话框上可以修改参数值以控制均线的显示，如下图所示。

高手秘技

技巧1 股市日记

写股市日记是一种辅助炒股看盘的方式，很多投资者在每日的点滴记录中发现自己的股市真经，这说明细节决定成败。

1　启动同花顺软件，在界面窗口单击右键，在弹出的快捷菜单选择【股市日记】选项，弹出【股市日记】对话框，如下图所示。

2　选择需要添加日记的日期，然后单击【记事】按钮，在弹出的【添加记事】对话框中输入标题和内容，如下图所示。

单击左下角的【提醒】下拉按钮，然后选择“有”，在日期选择框中单击，在弹出的日期列表上选择提醒的日期，如下图所示。

4　设置完成后，单击【保存】按钮，退出【股市日记】对话框，然后查看该股时可以看到该股前面有记事本标记，如下图所示。

双击记事本图表，即可弹出【查看记事】对话框，在该对话框中，可以对所记录的内容进行编辑，如下图所示。

技巧2 股市备忘录

股市备忘录与股市日记相似，所不同的是，股市日记除了当前日期，可以选择其他日期填写日记，以及设定提示日期，而股市备忘只能书写当前的备忘情况。具体操作步骤如下。

1　启动同花顺软件，在界面窗口单击右键，在弹出的快捷菜单中单击【股市备忘】选项，弹出【股市备忘】对话框，在该对话框中输入备忘的内容，如下图所示。

2　输入完成后，单击【确定】按钮，退出【股市备忘】对话框，然后单击【分时图】选项卡，即可看到备忘图钉，如下图所示。

双击图钉可以查看备忘内容，单击图钉可以对图钉的位置进行移动。